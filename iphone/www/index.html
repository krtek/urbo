<!DOCTYPE html>
<html>
    <head>
        <title>Urbo Mobile Reporter</title>
        <meta charset="utf-8"/>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
        <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"/>
        
        <!-- !!!REMOVE THIS WHEN GOING LIVE!!!, prevent cache -->
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="pragma" content="no-cache" />
        
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <title>Dobrý občan</title>
        <link media="only screen and (max-device-width: 480px)" href="http://ajax.googleapis.com/ajax/libs/dojo/1.7.3/dojox/mobile/themes/iphone/iphone.css" rel="stylesheet"></link>
        <link href="css/custom.css" rel="stylesheet"></link>
        <!-- !!!REMOVE THIS WHEN GOING LIVE!!!, easier debugging -->
        <script src="http://ajax.googleapis.com/ajax/libs/dojo/1.7.3/dojo/dojo.js.uncompressed.js"
            data-dojo-config="async:true"></script>
        
        <script type="text/javascript" charset="utf-8" src="cordova-1.9.0.js"></script>        
        <script type="text/javascript" charset="utf-8" src="js/scripts.js"></script>        
        <script type="text/javascript" charset="utf-8" src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
        <script type="text/javascript" charset="utf-8" src="js/lawnchair-0.6.1.min.js"></script>
        
        <!-- iPad/iPhone specific css below, add after your main css >
         <link rel="stylesheet" media="only screen and (max-device-width: 1024px)" href="ipad.css" type="text/css" />		
         <link rel="stylesheet" media="only screen and (max-device-width: 480px)" href="iphone.css" type="text/css" />		
         -->
        <script type="text/javascript">
            
            // If you want to prevent dragging, uncomment this section
            function preventBehavior(e) { 
                e.preventDefault(); 
            };
            document.addEventListener("touchmove", preventBehavior, false);
            
            /* If you are supporting your own protocol, the var invokeString will contain any arguments to the app launch.
             see http://iphonedevelopertips.com/cocoa/launching-your-own-application-via-a-custom-url-scheme.html
             for more details -jm */
            /*
             function handleOpenURL(url)
             {
             // TODO: do something with the url passed in.
             }
             */
            
            function onBodyLoad() {		
                document.addEventListener("deviceready", onDeviceReady, false);
            }
            
            /* When this function is called, Cordova has been initialized and is ready to roll */
            /* If you are supporting your own protocol, the var invokeString will contain any arguments to the app launch.
             see http://iphonedevelopertips.com/cocoa/launching-your-own-application-via-a-custom-url-scheme.html
             for more details -jm */
            function onDeviceReady() {

            }
            
            // Help function to read stored value
            function readStoredValue(store, key) {
                var retValue = '';
                store.exists(key, function(exists) {
                             if(exists) {
                                 store.get(key, function(readObject) {
                                              retValue = readObject.value;
                                           });
                             }
                             });
                return retValue;
            }
            
            // String trimmer, removes all left/right white spaces
            String.prototype.trim = function() {
                return this.replace(/^\s+|\s+$/g,"");
            }
            
            // Include all required modules of dojo, this list is created manually
            require([
                     "dojox/mobile/parser", // must be as the first required object
                     "dojox/mobile",
                     "dojox/mobile/compat", 
                     "dojox/mobile/deviceTheme", 
                     "dojox/mobile/Button",
                     "dojox/mobile/CheckBox",
                     "dojox/mobile/ExpandingTextArea",
                     "dojox/mobile/IconItem",                             
                     "dojox/mobile/ScrollableView",
                     "dojox/mobile/TextArea",
                     "dojox/mobile/TextBox",
                     "dojox/mvc",
                     "dojox/mvc/Group",
                     "dojox/mvc/Output"
                     ], 
                    function(parser, deviceTheme) {
                        // This defines the model object, all needed values should be stored here, only several of them can finally
                        // be send to the server
                        urboItem = dojox.mvc.newStatefulModel({ data : {
                                                                "Title" : "", 
                                                                "Photo" : {"Selected" : false,
                                                                           "URI" : ""},
                                                                "Location" : {"Latitude" : "",
                                                                              "Longitude" : "",
                                                                              "Address" : ""},
                                                                "Description" : "",
                                                                "Author" : {"Anonymized" : false,
                                                                            "Email" : "",
                                                                            "Firstname" : "",
                                                                            "Surname" : "",
                                                                            "Signature" : "",
                                                                            },
                                                                }});

                        // Try to read all stored values (some webkit storage place)
                        var store = new Lawnchair({name:'urboAuthor'}, function(store) {
                                                    urboItem.Author.Firstname = readStoredValue(store, 'firstname');
                                                    urboItem.Author.Surname = readStoredValue(store, 'surname');
                                                    urboItem.Author.Email = readStoredValue(store, 'email');
                                                  });
                        
                        // Parse the page for widgets, now the dojo will now what is facing with
                        parser.parse();
                    
                    dojo.connect(dijit.byId("anonSwitch"), "onStateChanged", function(newState){
                                 changeAnonSwitch(newState);
                                 });

                    }
            );
            
            String.prototype.trunc = function(n,useWordBoundary){
                var toLong = this.length>n,
                s_ = toLong ? this.substr(0,n-1) : this;
                s_ = useWordBoundary && toLong ? s_.substr(0,s_.lastIndexOf(' ')) : s_;
                return  toLong ? s_ + '&hellip;' : s_;
            };
            </script>
    </head>
    <body onload="onBodyLoad()">
        
        <!-- 
         A view represents one container (typically a page, dialog) in the mobile device.
         The first view will be the selected, or the one with 'selected' attribute set to 'true' 
         -->
        
        <!-- Menu of the application -->
        <div id="menuView" data-dojo-type="dojox.mobile.View">
            <div data-dojo-type="dojox.mobile.RoundRectList">
                <li data-dojo-type="dojox.mobile.ListItem">
                    <center>
                        <div><b>URBO 0.1 beta private</b></div>
                    </center>
                </li>
                <li data-dojo-type="dojox.mobile.ListItem" moveTo="newMessageView" transition="slide" onClick="prepareNewMessage();">Nová urbo zpráva</li>
                <li data-dojo-type="dojox.mobile.ListItem" moveTo="myMessagesView" transition="slide">Moje urbo zprávy</li>
                <li data-dojo-type="dojox.mobile.ListItem" data-dojo-props="variableHeight:true">
                    <center>
                        <img src="imgs/urbo.png" width="180" height="220" />
                    </center>
                </li>
                <li data-dojo-type="dojox.mobile.ListItem" moveTo="aboutAppView" transition="slide">O aplikaci...</li>
            </div>
        </div>
        
        <!-- Entering new message view -->
        <div id="newMessageView" data-dojo-type="dojox.mobile.View">
            <h1 data-dojo-type="dojox.mobile.Heading" label="Nová zpráva" back="Zpět" moveTo="menuView">
                <div data-dojo-type="dojox.mobile.ToolBarButton" label="Další" onClick="enterRecapView();" style="float:right;"></div>
            </h1>
            
            <div data-dojo-type="dojox.mobile.RoundRectList">
                <li data-dojo-type="dojox.mobile.ListItem" data-dojo-props='variableHeight:true'>
                    <div style="display: inline; text-align:center;">
                        <div style="display: inline;">
                            <button id="photoDataView" data-dojo-type="dojox.mobile.Button" data-dojo-props='label:"Vybrat foto"' baseClass="btnPhoto" onClick="getSomePhoto();" />
                        </div>
                        <div style="display: inline;">
                            <input id="titleDataView" data-dojo-type="dojox.mobile.TextBox" placeHolder="Titulek" data-dojo-props="ref: urboItem.Title" maxlength="40" />
                        </div>
                    </div>
                </li>
                <li data-dojo-type="dojox.mobile.ListItem" data-dojo-props='variableHeight:true'>
                    <span style="display: inline; text-align: center; white-space: nowrap;">
                        <img id="mapDataView" src="" style="height: 80px; width: 80px;" onClick="adjustLocation()" />
                        <textarea id="addressDataView" readonly="readonly" data-dojo-type="dojox.mobile.TextArea" cols="25" rows="5"></textarea>
                    </span>
                </li>
                <li data-dojo-type="dojox.mobile.ListItem" data-dojo-props='variableHeight:true'>
                    <textarea id="descriptionDataView" data-dojo-type="dojox.mobile.TextArea" style="width:95%;" cols="30" rows="5" maxLenght="300" placeHolder="Popis" data-dojo-props="ref: urboItem.Description"></textarea>
                </li>
            </div>
        </div>
        
        <!-- This view offers two ways to select a photo, from device's camera or from photo gallery -->
        <div id="getSomePhotoView" data-dojo-type="dojox.mobile.View">
            <h1 data-dojo-type="dojox.mobile.Heading" back="Zpět" moveTo="newMessageView" transition="slide">Přidání fotky</h1>
            <ul data-dojo-type="dojox.mobile.RoundRectList">
                <li data-dojo-type="dojox.mobile.ListItem" moveTo="#" onClick="getPhoto(Camera.PictureSourceType.CAMERA);">Kamera</li>
                <li data-dojo-type="dojox.mobile.ListItem" moveTo="#" onClick="getPhoto(Camera.PictureSourceType.PHOTOLIBRARY);">Galerie fotek</li>
            </ul>
        </div>
        
        <div id="provideAddressManuallyView" data-dojo-type="dojox.mobile.View">
            <h1 data-dojo-type="dojox.mobile.Heading" back="Zpět" moveTo="newMessageView">Vyhledání místa</h1>
            <ul data-dojo-type="dojox.mobile.RoundRectList">
                <li data-dojo-type="dojox.mobile.ListItem" moveTo="#" onClick="searchGpsCoordsManually()">
                    <input id="streetCityField" data-dojo-type="dojox.mobile.TextBox" placeHolder="Ulice, město" maxlength="40" />
                    <div id="locationSearchResult"></div>
                </li>
            </ul>
        </div>
        
        <div id="getLocationManuallyView" data-dojo-type="dojox.mobile.View">
            <h1 data-dojo-type="dojox.mobile.Heading" back="Zpět" moveTo="newMessageView">Mapa
                <div data-dojo-type="dojox.mobile.ToolBarButton" label="OK" class="mblColorBlue" style="width:45px;float:right;" moveTo="#" onClick="locationManuallySelected();"></div>
            </h1>
            <ul data-dojo-type="dojox.mobile.RoundRectList">
                <div id="mapWindow" style="width: 100%; min-height: 400px; height: 100%;"></div>
            </ul>
        </div>        
        
        <!-- Recapitulation of a message, displays all the important information -->
        <div id="recapView" data-dojo-type="dojox.mobile.View">
            <h1 data-dojo-type="dojox.mobile.Heading" back="Zpět" moveTo="newMessageView">Rekapitulace                
                <div data-dojo-type="dojox.mobile.ToolBarButton" label="Odeslat" class="mblColorBlue" style="width:45px;float:right;" moveTo="#" onClick="uploadPhoto()"></div>
            </h1>   
            
            <div data-dojo-type="dojox.mobile.RoundRectList">
                <li data-dojo-type="dojox.mobile.ListItem">
                    Pro: <button data-dojo-type="dojox.mobile.Button">MěÚ Chomutov</button>
                </li>
                <li data-dojo-type="dojox.mobile.ListItem">
                    Věc: <span data-dojo-type="dojox.mvc.Output" data-dojo-props="ref: urboItem.Title">${this.value}</span>
                </li>
                <li data-dojo-type="dojox.mobile.ListItem" data-dojo-props='variableHeight:true'>
                    Popis: <br/>
                    <span data-dojo-type="dojox.mvc.Output" data-dojo-props="ref: urboItem.Description">${this.value.trunc(300)}</span>
                </li>
                <li data-dojo-type="dojox.mobile.ListItem" data-dojo-props='variableHeight:true'>
                    Kde: <br/>
                    <span data-dojo-type="dojox.mvc.Output" data-dojo-props="ref: urboItem.Location.Address">${this.value.replace(/\\n/g, "<br/>")}</span>
                </li>
                <li data-dojo-type="dojox.mobile.ListItem" data-dojo-props='variableHeight:true'>
                    Fotka přiložena: <input id="photoAttachedCB" data-dojo-type="dojox.mobile.CheckBox" type="checkbox" readonly="readonly" style="float:right;" />
                </li>
                <li data-dojo-type="dojox.mobile.ListItem">
                    S úctou <button id="signature" data-dojo-type="dojox.mobile.Button" onClick="enterProfileView();" />
                </li>
            </div>
        </div>
        
        <div id="profileView" data-dojo-type="dojox.mobile.View">
            <h1 data-dojo-type="dojox.mobile.Heading" back="Zpět" moveTo="recapView">Profil uživatele                
                <div data-dojo-type="dojox.mobile.ToolBarButton" label="OK" class="mblColorBlue" style="width:45px;float:right;" onClick="saveProfileChanges();"></div>
            </h1>
            <div data-dojo-type="dojox.mobile.RoundRectList">
                <li data-dojo-type="dojox.mobile.ListItem">
                    Anonymní odeslání<div id="anonSwitch" class="mblItemSwitch" data-dojo-type="dojox.mobile.Switch" value="off" leftLabel="Ano" rightLabel="Ne"></div>
                </li>
                <li data-dojo-type="dojox.mobile.ListItem">
                    <div style="float:left;">Jméno:</div><div style="float:right;"><input id="firstnameField" data-dojo-type="dojox.mobile.TextBox" maxlength="30" /></div>
                </li>
                <li data-dojo-type="dojox.mobile.ListItem">
                    <div style="float:left;">Příjmení:</div> <div style="float:right;"><input id="surnameField" data-dojo-type="dojox.mobile.TextBox" maxlength="30" /></div>
                </li>
                <li data-dojo-type="dojox.mobile.ListItem">
                    <div style="float:left;">E-mail:</div><div style="float:right;"><input id="emailField" data-dojo-type="dojox.mobile.TextBox" maxlength="30" /></div>
                </li>
            </div>
        </div>
    </body>
</html>

